---
globs: src/app/api/**/*.ts
description: API route patterns and conventions
---

# API Route Patterns

## Next.js App Router API Routes
- Use proper HTTP methods (GET, POST, PUT, DELETE)
- Implement proper error handling and status codes
- Use TypeScript for request/response types
- Follow RESTful conventions

## Request/Response Patterns
```typescript
// Good: Proper API route structure
export async function POST(request: Request) {
  try {
    const body = await request.json()
    
    // Validate input
    if (!body.requiredField) {
      return NextResponse.json(
        { error: 'Missing required field' },
        { status: 400 }
      )
    }
    
    // Process request
    const result = await processData(body)
    
    return NextResponse.json(result, { status: 200 })
  } catch (error) {
    console.error('API Error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
```

## Authentication in API Routes
- Always validate user sessions
- Check user permissions for protected operations
- Use server-side authentication checks
- Return appropriate error responses for unauthorized access

## Error Handling
- Use consistent error response format
- Log errors for debugging
- Return appropriate HTTP status codes
- Handle validation errors gracefully

## Database Operations
- Use Prisma transactions for complex operations
- Implement proper error handling for database failures
- Use proper data validation before database operations
- Handle constraint violations appropriately

## Rate Limiting & Security
- Implement rate limiting for AI endpoints
- Validate all input data
- Use proper CORS settings
- Sanitize user inputs