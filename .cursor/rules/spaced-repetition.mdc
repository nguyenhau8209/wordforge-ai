---
globs: *.ts,*.tsx
description: Spaced repetition algorithm implementation
---

# Spaced Repetition System (SuperMemo Algorithm)

## Algorithm Implementation
The app implements the SuperMemo 2 algorithm for spaced repetition learning. This ensures optimal review scheduling based on user performance.

## Review Quality Ratings
- **0**: Complete blackout (forgot completely)
- **1**: Incorrect response with correct one remembered
- **2**: Incorrect response with correct one remembered after hesitation
- **3**: Correct response with serious difficulty
- **4**: Correct response with slight hesitation
- **5**: Perfect response

## Key Parameters
- **Ease Factor**: Starts at 2.5, adjusts based on performance
- **Interval**: Days until next review
- **Repetitions**: Number of times reviewed
- **Next Review**: Calculated date for next review

## Implementation Pattern
```typescript
// Good: Review calculation following SuperMemo algorithm
function calculateNextReview(
  quality: number,
  repetitions: number,
  easeFactor: number,
  interval: number
) {
  if (quality < 3) {
    // Reset if quality is too low
    return { repetitions: 0, interval: 1, easeFactor: 2.5 }
  }
  
  // Update ease factor
  const newEaseFactor = Math.max(1.3, 
    easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02))
  )
  
  // Calculate new interval
  let newInterval = repetitions === 0 ? 1 : 
                   repetitions === 1 ? 6 : 
                   Math.round(interval * newEaseFactor)
  
  return {
    repetitions: repetitions + 1,
    interval: newInterval,
    easeFactor: newEaseFactor,
    nextReview: new Date(Date.now() + newInterval * 24 * 60 * 60 * 1000)
  }
}
```

## Database Schema
- Store review data in [Review model](mdc:prisma/schema.prisma)
- Track user performance per flashcard
- Implement proper indexing for efficient queries
- Use unique constraint on (flashcardId, userId)

## Review Scheduling
- Query flashcards due for review
- Implement proper pagination for large datasets
- Handle timezone considerations
- Provide review statistics and progress tracking